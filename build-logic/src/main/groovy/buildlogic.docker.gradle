plugins {
    id 'com.google.cloud.tools.jib'
}

println "apply plugin 'com.google.cloud.tools.jib' for ${project.name}"

def dateTimeStr = new Date().format("yyyyMMddHHmm")

jib {
    from {
        image = 'docker-internal.youshengyun.com/tomcat:10.1-jre21-temurin'
        platforms {
            platform {
                architecture = 'amd64'
                os = 'linux'
            }
            platform {
                architecture = 'arm64'
                os = 'linux'
            }
        }
    }
//    container.appRoot = "/usr/local/tomcat/webapps/app"
    to {
        image "docker-registry-internal.youshengyun.com/${project.name}"
        auth {
            username = "${dockerUsername}"
            password = "${dockerPassword}"
        }
        tags = ['v9.7.0-SNAPSHOT', 'v9.7.x', "v9.7.0-SNAPSHOT-${dateTimeStr}"]
    }
}